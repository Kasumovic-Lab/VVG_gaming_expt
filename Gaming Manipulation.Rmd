ANALYZING THE EFFECT OF VIOLENT VIDEO GAME PLAY ON MATE VALUE AND OTHER MATING RELATED VARIABLES
========================================================

General housekeeping
--------------------

First load the libraries that we are using
```{r}
library(ggplot2)
library(knitr)
library(QuantPsyc)
library(PerformanceAnalytics)
library(heplots)
library(plyr)
require(gridExtra)
```

Next load the functions that we'll use for summary data

Using the script written here: http://www.r-bloggers.com/more-on-exploring-correlations-in-r/
to create the correlation data for the table, but also to create a figure of correlation values

See http://goo.gl/nahmV for documentation of this function
```{r}
cor.prob <- function (X, dfr = nrow(X) - 2) {
  R <- cor(X, use="pairwise.complete.obs")
  above <- row(R) < col(R)
  r2 <- R[above]^2
  Fstat <- r2 * dfr/(1 - r2)
  R[above] <- 1 - pf(Fstat, 1, dfr)
  R[row(R) == col(R)] <- NA
  R
}
```

Use this function to dump the cor.prob output to a 4 column matrix with row/column indices, correlation, and p-value. See StackOverflow question: http://goo.gl/fCUcQ

```{r}
flattenSquareMatrix <- function(m) {
  if( (class(m) != "matrix") | (nrow(m) != ncol(m))) stop("Must be a square matrix.") 
  if(!identical(rownames(m), colnames(m))) stop("Row and column names must be equal.")
  ut <- upper.tri(m)
  data.frame(i = rownames(m)[row(m)[ut]],
             j = rownames(m)[col(m)[ut]],
             cor=t(m)[ut],
             p=m[ut])
}
```

Use this function for summary statistics

```{r}
my.summary <- function(x, na.rm=TRUE){
  result <- c(Mean=mean(x, na.rm=na.rm),
              SD=sd(x, na.rm=na.rm),
              Median=median(x, na.rm=na.rm),
              Min=min(x, na.rm=na.rm),
              Max=max(x, na.rm=na.rm), 
              N=length(x))
}
```

Load the data (Complete_data_survey.csv).
Note the as.is thing which leaves all the character vectors as strings and does not make them into factors.

```{r}
data = read.table(file.choose(),  na.strings =".", header=T, sep=",")
```

Attach and check the headers of each column

```{r}
attach(data)
names(data)
```

Recode gender into numerical values

```{r}
data$Gender2 <- revalue(data$sex_response, c("Male"="1", "Female"="2"))
data$Gender2 <- as.numeric(as.character(data$Gender2))
```

Ensuring that certain columns are treated as categorical

```{r}
data$sexuality_response <- factor(data$sexuality_response)
data$age_response <- factor(data$age_response)
data$soirq1_response <- factor(data$soirq1_response)
data$soirq2_response <- factor(data$soirq2_response)
data$soirq3_response <- factor (data$soirq3_response)
```


Delete Rows where participants were unable to load or play game, or remember score, or have recorded gender as "Other".

```{r}
data<-data[-which(is.na(data$Removedata)),]
```

Then subset data by Study

```{r}
mturk = subset(data, study=="mturk")
```

Remove individuals that have a relationship status of 'other' (2 individuals)

```{r}
mturk = subset(mturk, relationshipstatus_response %in% c("Single", "In an open relationship/casually dating", "In a long-term monogamous relationship eg. married, partnered", "Recently single/divorced/separated"))
```

Here's mean centring the data
```{r}
mturk$mc_mvscaletotal <- scale(mturk$mvscaletotal, center = TRUE, scale = TRUE)
mturk$mc_SOIRTOTAL <- scale(mturk$SOIRTOTAL, center = TRUE, scale = TRUE)
mturk$mc_MvAverage <- scale(mturk$MvAverage, center = TRUE, scale = TRUE)
mturk$mc_SGAAverage <- scale(mturk$SGAAverage, center = TRUE, scale = TRUE)
mturk$mc_HostilityTotal <- scale(mturk$HostilityTotal, center = TRUE, scale = TRUE)
mturk$mc_MATINGMOTIVATION_total <- scale(mturk$MATINGMOTIVATION_total, center = TRUE, scale = TRUE)
```

---------------

What is the mean, SD and range of the age of respondents in the first sample?
```{r}
mean(mturk$age_response)
sd(mturk$age_response)
range(mturk$age_response)
```


Do men and women differ in the amount of violent video games they play (self-rated)

```{r}
VVGsexM1 <- lm(AverageFrequencyviolence_mean ~ sex_response + age_response + sex_response*age_response, data = mturk)
anova(VVGsexM1, test="Chisq")
```

Plot to see it. Boxplot of VVGplay between gender (Self-reported)

```{r}
ggplot(mturk, aes(x=sex_response, y=AverageFrequencyviolence_mean)) + geom_boxplot() + guides(fill=FALSE) + 
  xlab("Gender") +
  ylab("Self-Rated Violence Exposure") +
  theme(axis.line = element_line(colour = "black"),
        axis.text=element_text(size=18),
        axis.title=element_text(size=20,face="bold"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) 
```

Yes they do; women play less violent games. 

Now make a histogram of the overlap in violent video game play between the sexes
```{r}
hist1 <- ggplot(mturk, aes(x=AverageFrequencyviolence_mean, fill=sex_response)) + 
  geom_histogram(binwidth=2, position="dodge") +
  xlab("Self-rated Violence Exposure") +
  ylab("Count") +
  scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
  theme(axis.line = element_line(colour = "black"),
        plot.title = element_text(size=30, face="bold"),
        legend.position = "none",
        axis.text=element_text(size=18),
        axis.title=element_text(size=20,face="bold"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) 

hist1
```

get the columns that you want from the dataset
then create a correlation matrix
then get the p-values using function described above
"flatten"" that table using function described above  
?? which columns??
Factors: Gender, VVG exposure, MV1, MV2, SGA, Hostility, Mating motivation, SOIR, Game played, Sexuality, Age, Relationship status
```{r}
corrmturk <- mturk[, c(29,27,43,76,85,92,97,114,34,35,28,36)]
cor(corrmturk)
cor.prob(corrmturk)
flattenSquareMatrix(cor.prob(corrmturk))
```

Finally, plot the data using, but turn off warnings first
```{r}
options(warn=-1)
chart.Correlation(corrmturk1)
```

Now to get the means and SDs for the above selected columns using my.summary function

```{r}
sapply(corrmturk, my.summary)  
```

and then the numbers in each of the categorical groups

```{r}
table(mturk$sexuality_response)
table(mturk$relationshipstatus_response)
```

relevel the coefficients
```{r}
mturk$relationshipstatus_response <-relevel(mturk$relationshipstatus_response, "2")
mturk$sexuality_response <-relevel(mturk$sexuality_response, ref = "3")

```

Here is the full model

```{r}
VGplayself.all.mturk<-lm(Averagefrequencyviolence~ Mvscaletotal + MvAgerage + SOIRtotal + SGAAverage + HostilityTotal + MATINGMOTIVATION_total + sex_response + sexuality_response + age_response + relationshipstatus_response + VorNV +` sex_response*mvscaletotal + sex_response*SOIRtotal+ sex_response*MvAverage +sex_response*SGAAverage + sex_response*HostilityTotal + sex_response*MATINGMOTIVATION_total + sex_response*sexuality_response + sex_response*relationshipstatus_response, data=mturk)

anova(VGplayself.all.mturk, test="typeIII")
summary(VGplayself.all.mturk)

etasq(VGplayself.all.mtur)
```

calculate r-squared for relationship between SOI & MV with VVGExposure

```{r}
r_mturk_SOIR <- lm(Averageviolencefrequency ~ SOIRTOTAL, data=mturk)
summary(r_mturk1_SOIR)

r_mturk_MV.m <- lm(Averageviolencefrequency ~ Mvscaletotal, data=subset(mturk, sex_response="Male"))
summary(r_mturk_MV.m)

r_mturk_MV.f <- lm(Averageviolencefrequency ~ Mvscaletotal, data=subset(mturk, sex_response=="Female"))
summary(r_mturk_MV.f)

r_mturk_MV2.m <- lm(Averageviolencefrequency ~ MvAverage, data=subset(mturk, sex_response="Male"))
summary(r_mturk_MV2.m)

r_mturk_MV2.f <- lm(Averageviolencefrequency ~ MvAverage, data=subset(mturk, sex_response=="Female"))
summary(r_mturk_MV2.f)
```

these are standardized coefficients...apparantly

```{r}
lm.beta(VGplayself.all.mturk)
```

It seems SOI has an overall effect and there is an interaction between Mate Value and Gender

Plot Mate Value and VVGplay for each gender - 22 question mv scale

```{r}
plotMvAverage <- ggplot(mturk, aes(x = MvAverage, y = Averagefrequencyviolence, color = sex_response, shape = sex_response, linetype = sex_response)) + 
  geom_point(size = 4) + 
  ylim(0,50) +
  scale_colour_hue(l=50, guide = FALSE) +
  scale_x_continuous(limits=c(0.5,7.5), breaks=c(1:7)) +
  theme_bw() + geom_smooth(method=lm,  fullrange=T) + 
  xlab("Mate Value") +
  ylab("Violent Video Game Exposure") +
  theme(legend.position="none") +
  theme(axis.line = element_line(colour = "black"),
        axis.text=element_text(size=18),
        axis.title=element_text(size=20,face="bold"),
        axis.title.y=element_text(vjust=0.25),
        axis.title.x=element_text(vjust=0.25),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) 
plotMV1
```

Plot with MVscaletotal - 4 general MV questions 
```{r}
plotMvscaletotal <- ggplot(mturk, aes(x = Mvscaletotal, y = Averagefrequencyviolence, color = sex_response, shape = sex_response, linetype = sex_response)) + 
  geom_point(size = 4) + 
  ylim(0,50) +
  scale_colour_hue(l=50, guide = FALSE) +
  scale_x_continuous(limits=c(0.5,7.5), breaks=c(1:7)) +
  theme_bw() + geom_smooth(method=lm,  fullrange=T) + 
  xlab("Mate Value") +
  ylab("Violent Video Game Exposure") +
  theme(legend.position="none") +
  theme(axis.line = element_line(colour = "black"),
        axis.text=element_text(size=18),
        axis.title=element_text(size=20,face="bold"),
        axis.title.y=element_text(vjust=0.25),
        axis.title.x=element_text(vjust=0.25),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) 
plotMV1
```

Now, plot both MV figures together
```{r}
grid.arrange(plotMV1, plotMV2, ncol=2)
g <- arrangeGrob(plotMV1, plotMV2, ncol=2)
ggsave(file="MateValue.tiff",g)
```

Now plot SOI
```{r}
plotSOI1 <- ggplot(mturk, aes(x = SOIRTOTAL, y = Averagefrequencyviolence, color = sex_response, shape = sex_response, linetype = sex_response)) + 
  geom_point(size=4) +
  ylim(0,50) +
  scale_colour_hue(l=50, guide = FALSE) +
  scale_x_continuous(limits=c(0,80)) +
  theme_bw() + geom_smooth(method=lm,  fullrange=T) + 
  xlab("Sexual Interest") +
  ylab("Violent Video Game Exposure") +
  theme(legend.position="none") +
  theme(axis.line = element_line(colour = "black"),
        axis.text=element_text(size=18),
        axis.title=element_text(size=20,face="bold"),
        axis.title.y=element_text(vjust=0.25),
        axis.title.x=element_text(vjust=0.25),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank()) 
plotSOI1
```


Now plot mating motivation
```{r}
ggplot(mturk, aes(x = MATINGMOTIVATION_total, y = Averagefrequencyviolence, color = sex_response, shape = sex_response, linetype = sex_response)) + 
  geom_point(size=4) +
  theme_bw() + geom_smooth(method=lm, fullrange=T) + 
  scale_colour_hue(l=50, guide = FALSE) +
  ylim(0,50) +
  scale_x_continuous(limits=c(0.75,7.25), breaks=c(1:7)) +
  xlab("Gaming Motivation") +
  ylab("Violent Video Game Exposure") +
  theme(axis.line = element_line(colour = "black"),
        axis.text=element_text(size=18),
        axis.title=element_text(size=20,face="bold"),
        axis.title.y=element_text(vjust=0.25),
        axis.title.x=element_text(vjust=0.25),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position=c(.90,.10)) 

```



Supplementary Materials
-----------------------

Here is the full model with age and all the interactions for Mturk 1

```{r}
VGplayself.all.mturk<-lm(Averagefrequencyviolence ~ Mvscaletotal + MvAverage + SGAAverage+ HostilityTotal  + MATINGMOTIVATION_total + SOIRTOTAL + sexuality_response + sex_response + age_response + relationshipstatus_response +VorNV + sex_response*Mvscaletotal +sex_response**MvAverage +sex_response*sexuality_response +sex_response*relationshipstatus_response+ age_response*Mvscaletotal +age_response*MvAverage + age_response*SGAAverage + age_response*HostilityTotal + age_response*MATINGMOTIVATION_total +age_response*SOIRTOTAL + age_response*sexuality_response + age_response*relationshipstatus_response, data=mturk)

anova(VGplayself.all.mturk1, test="Chisq")
summary(VGplayself.all.mturk1)
```
